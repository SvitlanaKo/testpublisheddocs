<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cache in Oro Application &#8212; OroCommerce 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Message Queue" href="mq/index.html" />
    <link rel="prev" title="DataBase System Component" href="database/index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
<div class="header">
    <div class="main-nav">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div id="nav-menu" class="navbar-top">
                <div class="nav-container">
                    <div class="navbar-header">
                        <a href="https://www.orocommerce.com/"
                           class="navbar-brand"><img
                                src="https://www.orocommerce.com/wp-content/themes/commerce/images/orocommerce_logo.svg"
                                alt="Open Source B2B eCommerce Platform - OroCommerce"></a>
                    </div>
                    <div class="navbar-header">
                        <p class="navbar-header" href="#">Documentation</p>
                    </div>
                    <div class="navbar-right">
                        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mq/index.html" title="Message Queue"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="database/index.html" title="DataBase System Component"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Administrator Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Operational Structure</a> &#187;</li> 
     <li class="nav-item nav-item-this">Cache in Oro Application</li>
      </ul>
    </div>
                    </div>

                </div>
            </div>

        </nav>
    </div>
</div>


      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cache-in-oro-application">
<span id="op-structure-cache"></span><h1>Cache in Oro Application<a class="headerlink" href="#cache-in-oro-application" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">OroCacheBundle</span></code> is responsible for operations with various kinds of caches.</p>
<div class="section" id="abstract-cache-services">
<h2>Abstract Cache Services<a class="headerlink" href="#abstract-cache-services" title="Permalink to this headline">¶</a></h2>
<p>There are two abstract services you can use as a parent for your cache services:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">oro.file_cache.abstract</span></code> - this cache should be used for caching
data private for each node in a web farm</li>
<li><code class="docutils literal"><span class="pre">oro.cache.abstract</span></code> - this cache should be used for caching data
that need to be shared between nodes in a web farm</li>
</ul>
<p>The following example shows how these services can be used:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>services:
    acme.test.cache:
        public: false
        parent: oro.cache.abstract
        calls:
            - [ setNamespace, [ &#39;acme_test&#39; ] ]
</pre></div>
</div>
<p>Also each of these abstract services can be re-declared in the application configuration file, for example:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>services:
    oro.cache.abstract:
        abstract: true
        class:                Oro\Bundle\CacheBundle\Provider\PhpFileCache
        arguments:            [%kernel.cache_dir%/oro_data]
</pre></div>
</div>
<p>Read more about the <a class="reference external" href="https://github.com/oroinc/platform/blob/master/src/Oro/Bundle/CacheBundle/Resources/doc/caching_policy.md">caching policy and default implementation</a>.</p>
<div class="section" id="caching-policy">
<h3>Caching Policy<a class="headerlink" href="#caching-policy" title="Permalink to this headline">¶</a></h3>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#memory-based-cache" id="id4">Memory Based Cache</a></li>
<li><a class="reference internal" href="#persistent-or-shared-cache" id="id5">Persistent or Shared cache</a></li>
<li><a class="reference internal" href="#cache-chaining" id="id6">Cache Chaining</a></li>
<li><a class="reference internal" href="#default-cache-implementation" id="id7">Default Cache Implementation</a></li>
</ul>
</div>
<div class="section" id="memory-based-cache">
<h4><a class="toc-backref" href="#id4">Memory Based Cache</a><a class="headerlink" href="#memory-based-cache" title="Permalink to this headline">¶</a></h4>
<p>One of the most important things when dealing with caches is proper cache
invalidation. When using memory based cache, we need to make sure that we
do not keep old values in the memory. Consider this example:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">LocalizationManager</span>
<span class="p">{</span>
    <span class="sd">/** @var \Doctrine\Common\Cache\ArrayCache */</span>
    <span class="k">private</span> <span class="nv">$cacheProvider</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getLocalization</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$localization</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cacheProvider</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="c1">// ... all other operations, fetch from DB if cache is empty</span>
        <span class="c1">// ... save in cache data from DB</span>

        <span class="k">return</span> <span class="nv">$localization</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Since <code class="docutils literal"><span class="pre">$cacheProvider</span></code> in our example is an implementation of memory
<code class="docutils literal"><span class="pre">ArrayCache</span></code>, we will keep the data there until the process ends. With
HTTP request this would work perfectly well, but when our
<code class="docutils literal"><span class="pre">LocalizationManager</span></code> is used in some long-running cli
processes, we have to manually clear memory cache after every change
with Localizations. Missing cache clearing for any of these cases leads
to outdated data in <code class="docutils literal"><span class="pre">LocalizationManager</span></code>.</p>
</div>
<div class="section" id="persistent-or-shared-cache">
<h4><a class="toc-backref" href="#id5">Persistent or Shared cache</a><a class="headerlink" href="#persistent-or-shared-cache" title="Permalink to this headline">¶</a></h4>
<p>Let us have a look at our example once again. Since
<code class="docutils literal"><span class="pre">LocalizationManager</span></code> is used in the CLI and we do not have the shared
memory, we would not be able to invalidate the cache between different
processes. We probably would go for some more persistent (shared) way of
caching, for example, <code class="docutils literal"><span class="pre">FilesystemCache</span></code>. Now, we are able to share
cache between processes, but this approach causes performance
degradation. In general, the memory cache is much faster than the persistent
one.</p>
</div>
<div class="section" id="cache-chaining">
<h4><a class="toc-backref" href="#id6">Cache Chaining</a><a class="headerlink" href="#cache-chaining" title="Permalink to this headline">¶</a></h4>
<p>The solution to the issue mentioned above is to keep a healthy balance
between the fast and shared cache. It is implemented in the
<code class="docutils literal"><span class="pre">ChainCache</span></code> class.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Oro\Bundle\CacheBundle\Provider</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\Cache\ArrayCache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Cache\ChainCache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MemoryCacheChain</span> <span class="k">extends</span> <span class="nx">ChainCache</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritdoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$cacheProviders</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">PHP_SAPI</span> <span class="o">!==</span> <span class="s1">&#39;cli&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">array_unshift</span><span class="p">(</span><span class="nv">$cacheProviders</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ArrayCache</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$cacheProviders</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This class checks whether a request comes from the CLI. If not, the
memory <code class="docutils literal"><span class="pre">ArrayCache</span></code> is added to the top of the cache providers which
are being used for caching. With these priorities set, all HTTP requests
gain performance when dealing with caches in memory and the CLI
processes have no issues with the outdated data as they use the
persistent cache.</p>
</div>
<div class="section" id="default-cache-implementation">
<h4><a class="toc-backref" href="#id7">Default Cache Implementation</a><a class="headerlink" href="#default-cache-implementation" title="Permalink to this headline">¶</a></h4>
<p>As you may read in <a class="reference external" href="https://github.com/oroinc/platform/blob/master/src/Oro/Bundle/CacheBundle/README.md#abstract-cache-services">Readme</a> there are two abstract services you can use
as a parent for your cache services. Default implementations are
following: - for CLI requests: <code class="docutils literal"><span class="pre">MemoryCacheChain</span></code> with only
<code class="docutils literal"><span class="pre">Oro\Bundle\CacheBundle\Provider\FilesystemCache</span></code> as a cache provider
- for other requests: <code class="docutils literal"><span class="pre">MemoryCacheChain</span></code> with <code class="docutils literal"><span class="pre">ArrayCache</span></code> on the
top of <code class="docutils literal"><span class="pre">FilesystemCache</span></code></p>
</div>
</div>
</div>
<div class="section" id="apc-cache">
<h2>APC Cache<a class="headerlink" href="#apc-cache" title="Permalink to this headline">¶</a></h2>
<p>There is a possibility to use APC cache and few steps should be
completed for this.</p>
<p>First of all, APC should be installed and enabled in the system. After
this, the production configuration file (<code class="docutils literal"><span class="pre">config_prod.yml</span></code>) should be
updated with the following parameters:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>doctrine:
    orm:
        auto_mapping: true
        query_cache_driver:    apc
        metadata_cache_driver: apc
        result_cache_driver: apc

services:
    oro.cache.abstract:
        abstract:             true
        class:                Doctrine\Common\Cache\ApcCache
</pre></div>
</div>
<p>At the last step of the configuration, production cache should be cleared.</p>
</div>
<div class="section" id="caching-of-symfony-validation-rules">
<h2>Caching of Symfony Validation Rules<a class="headerlink" href="#caching-of-symfony-validation-rules" title="Permalink to this headline">¶</a></h2>
<p>By default, rules for <a class="reference external" href="http://symfony.com/doc/current/book/validation.html">Symfony Validation Component</a> are cached using
<code class="docutils literal"><span class="pre">oro.cache.abstract</span></code> service, but you can change this to make
validation caching suit some custom requirements. To do this, you need
to redefine the <code class="docutils literal"><span class="pre">oro_cache.provider.validation</span></code> service.</p>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install_upgrade/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../seo_config_guide/index.html">SEO Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frontstore_guide/index.html">Front Store Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administrator Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Operational Structure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="search_index/index.html">Search Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="database/index.html">DataBase System Component</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cache in Oro Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="mq/index.html">Message Queue</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../optimize_server_compression_and_caching.html">Web Server Performance Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../price_list_sharding.html">How to Configure Price List Sharding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimize_index_and_price_calculation.html">Optimize Website Indexation and Price Recalculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../package_manager.html">Extensions and Package Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processes.html">Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jobs.html">Job Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cron.html">Scheduled Tasks via Cron</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.html">Healthcheck and Data Monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration_guide/index.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system_requirements.html">System Requirements</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Oro Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../../_sources/admin_guide/op_structure/cache.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>