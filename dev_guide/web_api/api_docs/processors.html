<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Processors &#8212; OroCommerce 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configure Stateless Security Firewalls" href="security.html" />
    <link rel="prev" title="How to" href="how_to.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<script language="javascript" type="text/javascript">
    <!--
    var materialdropdown = document.querySelector('.material-dropdown'),
    middle = document.querySelector('.middle'),
    cross = document.querySelector('.cross'),
    dropdown = document.querySelector('.dropdown');

materialdropdown.addEventListener('click', function() {
  middle.classList.toggle('active');
  cross.classList.toggle('active');
  dropdown.classList.toggle('active');
})
    -->
  </script>
    


  </head>
  <body role="document">
  

    <div class="document">
<div class="header">
    <div class="main-nav">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div id="nav-menu" class="navbar-top">
                <div class="nav-container">
                    <div class="navbar-header">
                        <a href="https://www.orocommerce.com/"
                           class="navbar-brand"><img
                                src="https://www.orocommerce.com/wp-content/themes/commerce/images/orocommerce_logo.svg"
                                alt="Open Source B2B eCommerce Platform - OroCommerce"></a>
                    </div>
                    <div class="navbar-header">
                        <p class="navbar-header" href="#">Documentation</p>
                    </div>
                    <div class="navbar-right">
                        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="security.html" title="Configure Stateless Security Firewalls"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="how_to.html" title="How to"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Web Services API</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">API Documentation</a> &#187;</li> 
     <li class="nav-item nav-item-this">Processors</li>
      </ul>
    </div>
                    </div>

                </div>
            </div>

        </nav>
    </div>
</div>


      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="processors">
<h1>Processors<a class="headerlink" href="#processors" title="Permalink to this headline">¶</a></h1>
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="#overview">Overview</a></li>
<li><a class="reference external" href="#creating-a-processor">Creating a processor</a></li>
<li><a class="reference external" href="#processor-conditions">Processor conditions</a></li>
<li><a class="reference external" href="#examples-of-processor-conditions">Examples of processor conditions</a></li>
<li><a class="reference external" href="#error-handling">Error handling</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>A processor is the main element where a business logic of Data API is implemented. Each processor must implement <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/ProcessorInterface.php">ProcessorInterface</a> and be registered in the dependency injection container using the <code class="docutils literal"><span class="pre">oro.api.processor</span></code> tag.</p>
<p>Please see <a class="reference external" href="./actions.rst">actions</a> section for more details about where and how processors are used.</p>
<p>Also you can use the <a class="reference external" href="./commands#oroapidebug">oro:api:debug</a> command to see all actions and processors.</p>
</div>
<div class="section" id="creating-a-processor">
<h2>Creating a processor<a class="headerlink" href="#creating-a-processor" title="Permalink to this headline">¶</a></h2>
<p>To create a new processor just create a class implements <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/ProcessorInterface.php">ProcessorInterface</a> and <a class="reference external" href="http://symfony.com/doc/current/book/service_container.html#book-service-container-tags">tag</a> it with the <code class="docutils literal"><span class="pre">oro.api.processor</span></code> name.</p>
<div class="code php highlight-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Acme\Bundle\ProductBundle\Api\Processor</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ContextInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ProcessorInterface</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * A short description what the processor does.</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">DoSomething</span> <span class="k">implements</span> <span class="nx">ProcessorInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritdoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">process</span><span class="p">(</span><span class="nx">ContextInterface</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// do some work here</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">services</span><span class="o">:</span>
    <span class="nx">acme</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="o">.</span><span class="nx">do_something</span><span class="o">:</span>
        <span class="nx">class</span><span class="o">:</span> <span class="nx">Acme\Bundle\ProductBundle\Api\Processor\DoSomething</span>
        <span class="nx">tags</span><span class="o">:</span>
            <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">normalize_input</span><span class="p">,</span> <span class="nx">priority</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>
</pre></div>
</div>
<p>Please note that:</p>
<ul class="simple">
<li>The name of a processor usually starts with a verb and the <code class="docutils literal"><span class="pre">Processor</span></code> suffix is not used.</li>
<li>A processor must be a public service because it is loaded on demand.</li>
<li>The <code class="docutils literal"><span class="pre">priority</span></code> attribute is used to control the order in which processors are executed. The highest the priority, the earlier a processor is executed. Default value is 0. The possible range is from -255 to 255. But for some types of processors the range can be different. More details you can find in the <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/README.md#types-of-processors">documentation of the ChainProcessor</a> component. If several processors have
the same priority the order they are executed is unpredictable.</li>
<li>Each processor should check whether its&#8217; work is already done, because there can be a processor with higher priority which does the same but in another way. For example such processors can be created for customization purposes.</li>
<li>As Data API resources can be created for any type of objects, not only ORM entities, it is always a good idea to check whether a processor is applicable for ORM entities. This check is very fast and allows to avoid possible logic issues and performance impact. Please use the <code class="docutils literal"><span class="pre">oro_api.doctrine_helper</span></code> service to get an instance of
<cite>OroBundleApiBundleUtilDoctrineHelper</cite> &lt;<a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Util/DoctrineHelper.php">https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Util/DoctrineHelper.php</a>&gt;`__ as this class is optimized to be used in Data API stack. An example:</li>
</ul>
<div class="code php highlight-php"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">process</span><span class="p">(</span><span class="nx">ContextInterface</span> <span class="nv">$context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$entityClass</span> <span class="o">=</span> <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">getClassName</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">doctrineHelper</span><span class="o">-&gt;</span><span class="na">isManageableEntityClass</span><span class="p">(</span><span class="nv">$entityClass</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// only manageable entities are supported</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// do some work</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The list of all existing processors you can find in the <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Processor">Processor</a> folder.</p>
</div>
<div class="section" id="processor-conditions">
<h2>Processor conditions<a class="headerlink" href="#processor-conditions" title="Permalink to this headline">¶</a></h2>
<p>When you register a processor in the dependency injection container you can specify conditions when the processor should be executed. The attributes of the <code class="docutils literal"><span class="pre">oro.api.processor</span></code> tag is used to specify conditions. Any context property which is scalar, array or object (instance of the <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/ToArrayInterface.php">ToArrayInterface</a>) can be used in the conditions. Lets see a very simple condition which is used to filter
processors by the action:</p>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">services</span><span class="o">:</span>
    <span class="nx">acme</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="o">.</span><span class="nx">do_something</span><span class="o">:</span>
        <span class="nx">class</span><span class="o">:</span> <span class="nx">Acme\Bundle\ProductBundle\Api\Processor\DoSomething</span>
        <span class="nx">tags</span><span class="o">:</span>
            <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get</span> <span class="p">}</span>
</pre></div>
</div>
<p>In this case the <code class="docutils literal"><span class="pre">acme.api.processor.do_something</span></code> will be executed only in scope of the <code class="docutils literal"><span class="pre">get</span></code> action, for other actions this processor will be skipped.</p>
<p>The main goal of the conditions is to provide a simple way to specify which processors are required to accomplish some work. Also it is very important to understand that the processors are not fit the conditions will not be loaded from the dependency injection container at all. So, using of the conditions allows to create fast Data API.</p>
<p>This allows to build conditions based on any attribute from the context.</p>
<p>The types of conditions depend on registered <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/README.md#applicable-checkers">Applicable Checkers</a>. By default the following checkers are registered:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Processor/MatchApplicableChecker.php">MatchApplicableChecker</a></li>
</ul>
<p>Also, by performance reasons, the functionality of <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/SkipGroupApplicableChecker.php">SkipGroupApplicableChecker</a> and <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Component/ChainProcessor/GroupRangeApplicableChecker.php">GroupRangeApplicableChecker</a> was implemented as part of
<a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Processor/OptimizedProcessorIterator.php">OptimizedProcessorIterator</a>.</p>
</div>
<div class="section" id="examples-of-processor-conditions">
<h2>Examples of processor conditions<a class="headerlink" href="#examples-of-processor-conditions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>No conditions. A processor is executed for all actions.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for a specified action.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for a specified action and group.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for a specified action, group and request type.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="nx">rest</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed for all requests except a specified one.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="o">!</span><span class="nx">rest</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for REST requests conform <a class="reference external" href="http://jsonapi.org/">JSON.API</a> specification.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="nx">rest</span><span class="o">&amp;</span><span class="nx">json_api</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed either for REST requests or requests conform <a class="reference external" href="http://jsonapi.org/">JSON.API</a> specification.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="nx">rest</span><span class="o">|</span><span class="nx">json_api</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Please note</strong> that a value can contain either <code class="docutils literal"><span class="pre">&amp;</span></code> (logical AND) or <code class="docutils literal"><span class="pre">|</span></code> (logical OR) operators, but it is not possible to combine them.</p>
<ul class="simple">
<li>A processor is executed for all REST requests excluding requests conform <a class="reference external" href="http://jsonapi.org/">JSON.API</a> specification.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">requestType</span><span class="o">:</span> <span class="nx">rest</span><span class="o">&amp;!</span><span class="nx">json_api</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed for several specified actions.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">priority</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">priority</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for a specified entity.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">class</span><span class="o">:</span> <span class="s1">&#39;Oro\Bundle\UserBundle\Entity\User&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>A processor is executed only for entities that implement some interface or extend some base class. Currently there are two attributes that being compared by <strong>instance of</strong> instead of <strong>equal</strong> operator. These attributes are <strong>class</strong> and <strong>parentClass</strong>.</li>
</ul>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">tags</span><span class="o">:</span>
    <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">get_list</span><span class="p">,</span> <span class="nx">group</span><span class="o">:</span> <span class="nx">initialize</span><span class="p">,</span> <span class="nx">class</span><span class="o">:</span> <span class="s1">&#39;Oro\Bundle\UserBundle\Entity\AbstractUser&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>More examples you can find in <a class="reference external" href="../config">configuration of existing processors</a>. See <code class="docutils literal"><span class="pre">processors.*.yml</span></code> files.</p>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>There are several types of errors that may occur during the process of a request:</p>
<ul class="simple">
<li><strong>Validation errors</strong>. A validation error will occur if a request has some invalid parameters, headers or data.</li>
<li><strong>Security errors</strong>. This type of error will occur if an access is denied to a requested, updating or deleting entity.</li>
<li><strong>Unexpected errors</strong>. These errors will occur if some unpredictable problem happens. E.g. no access to a database or a file system, requested entity does not exist, updating entity is blocked, etc.</li>
</ul>
<p>Please note that to validate input data for <a class="reference external" href="./actions#create-action">create</a> and <a class="reference external" href="./actions#update-action">update</a> actions the best solution is to use validation constraints. In most cases it allows to not write any PHP code and configure required validation rules in <code class="docutils literal"><span class="pre">Resources/config/oro/api.yml</span></code>. The detailed information how to add own validation constraints can be found in <a class="reference external" href="./forms.rst">Forms and Validators Configuration</a> document. The following example shows how to add a
validation constraint via <code class="docutils literal"><span class="pre">Resources/config/oro/api.yml</span></code>:</p>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">api</span><span class="o">:</span>
    <span class="nx">entities</span><span class="o">:</span>
        <span class="nx">Acme\Bundle\AcmeBundle\Entity\AcmeEntity</span><span class="o">:</span>
            <span class="nx">fields</span><span class="o">:</span>
                <span class="nx">primaryEmail</span><span class="o">:</span>
                    <span class="nx">form_options</span><span class="o">:</span>
                        <span class="nx">constraints</span><span class="o">:</span>
                            <span class="c1"># add Symfony\Component\Validator\Constraints\Email validation constraint</span>
                            <span class="o">-</span> <span class="nx">Email</span><span class="o">:</span> <span class="o">~</span>
</pre></div>
</div>
<p>If an error occurs in a processor, the main execution flow is interrupted and the control is passed to a special group of processors, that is named <strong>normalize_result</strong>. This is true for all types of errors. But there are some exceptions for this rule for the errors that occur in any processor of the <strong>normalize_result</strong> group. The execution flow is interrupted only if any of these processors raises an exception. However, these processors can safely add new errors into the
<a class="reference external" href="./actions#context-class">Context</a> and the execution of the next processors will not be interrupted. For implementation details see <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Processor/RequestActionProcessor.php">RequestActionProcessor</a>.</p>
<p>An error is represented by <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Model/Error.php">Error</a> class. Also there is <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Model/ErrorSource.php">ErrorSource</a> class that can be used to specify a source of an error, e.g. the name of URI parameter or the path to a property in request data. These classes have the following methods:</p>
<p><strong>Error</strong> class</p>
<ul class="simple">
<li><strong>create(title, detail)</strong> <em>static</em> - Creates an instance of <strong>Error</strong> class.</li>
<li><strong>createValidationError(title, detail)</strong> <em>static</em> - Creates an instance of <strong>Error</strong> class represents a violation of validation constraint.</li>
<li><strong>createByException(exception)</strong> <em>static</em> - Creates an instance of <strong>Error</strong> class based on a given exception object.</li>
<li><strong>getStatusCode()</strong> - Gets the HTTP status code applicable to this problem.</li>
<li><strong>getCode()</strong> - Gets an application-specific error code.</li>
<li><strong>setCode(code)</strong> - Sets an application-specific error code.</li>
<li><strong>getTitle()</strong> - Gets a short, human-readable summary of the problem that should not change from occurrence to occurrence of the problem.</li>
<li><strong>setTitle(title)</strong> - Sets a short, human-readable summary of the problem that should not change from occurrence to occurrence of the problem.</li>
<li><strong>getDetail()</strong> - Gets a human-readable explanation specific to this occurrence of the problem.</li>
<li><strong>setDetail(detail)</strong> - Sets a human-readable explanation specific to this occurrence of the problem.</li>
<li><strong>getSource()</strong> - Gets instance of <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Model/ErrorSource.php">ErrorSource</a> represents a source of this occurrence of the problem.</li>
<li><strong>setSource(source)</strong> - Sets instance of <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Model/ErrorSource.php">ErrorSource</a> represents a source of this occurrence of the problem.</li>
<li><strong>getInnerException()</strong> - Gets an exception object that caused this occurrence of the problem.</li>
<li><strong>setInnerException(exception)</strong> - Sets an exception object that caused this occurrence of the problem.</li>
<li><strong>trans(translator)</strong> - Translates all attributes that are represented by the <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Model/Label.php">Label</a> object.</li>
</ul>
<p><strong>ErrorSource</strong> class</p>
<ul class="simple">
<li><strong>createByPropertyPath(propertyPath)</strong> <em>static</em> - Creates an instance of <strong>ErrorSource</strong> class represents the path to a property caused the error.</li>
<li><strong>createByPointer(pointer)</strong> <em>static</em> - Creates an instance of <strong>ErrorSource</strong> class represents a pointer to a property in the request document caused the error.</li>
<li><strong>createByParameter(parameter)</strong> <em>static</em> - Creates an instance of <strong>ErrorSource</strong> class represents URI query parameter caused the error.</li>
<li><strong>getPropertyPath()</strong> - Gets the path to a property caused the error. E.g. &#8220;title&#8221;, or &#8220;author.name&#8221;.</li>
<li><strong>setPropertyPath(propertyPath)</strong> - Sets the path to a property caused the error.</li>
<li><strong>getPointer()</strong> - Gets a pointer to a property in the request document caused the error. For JSON documents the pointer conforms <a class="reference external" href="https://tools.ietf.org/html/rfc6901">RFC 6901</a>. E.g. &#8220;/data&#8221; for a primary data object, or &#8220;/data/attributes/title&#8221; for a specific attribute.</li>
<li><strong>setPointer(pointer)</strong> - Sets a pointer to a property in the request document caused the error.</li>
<li><strong>getParameter()</strong> - Gets URI query parameter caused the error.</li>
<li><strong>setParameter(parameter)</strong> - Sets URI query parameter caused the error.</li>
</ul>
<p>Lets consider how a processor can inform that some error is occurred.</p>
<p>The simplest way is just throw an exception. For example:</p>
<div class="code php highlight-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Oro\Bundle\ApiBundle\Processor\Shared</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\QueryBuilder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ContextInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ProcessorInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Component\EntitySerializer\EntitySerializer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\ApiBundle\Exception\RuntimeException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\ApiBundle\Processor\Context</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Loads entity using the EntitySerializer component.</span>
<span class="sd"> * As returned data is already normalized, the &quot;normalize_data&quot; group will be skipped.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">LoadEntityByEntitySerializer</span> <span class="k">implements</span> <span class="nx">ProcessorInterface</span>
<span class="p">{</span>
    <span class="sd">/** @var EntitySerializer */</span>
    <span class="k">protected</span> <span class="nv">$entitySerializer</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param EntitySerializer $entitySerializer</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">EntitySerializer</span> <span class="nv">$entitySerializer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entitySerializer</span> <span class="o">=</span> <span class="nv">$entitySerializer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritdoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">process</span><span class="p">(</span><span class="nx">ContextInterface</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var Context $context */</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$context</span><span class="o">-&gt;</span><span class="na">hasResult</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// data already retrieved</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$query</span> <span class="nx">instanceof</span> <span class="nx">QueryBuilder</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// unsupported query</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">getConfig</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// an entity configuration does not exist</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entitySerializer</span><span class="o">-&gt;</span><span class="na">serialize</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">&#39;The result must have one or zero items.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">setResult</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

        <span class="c1">// data returned by the EntitySerializer are already normalized</span>
        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">skipGroup</span><span class="p">(</span><span class="s1">&#39;normalize_data&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This way is good to for unexpected and security errors (for security errors just throw <code class="docutils literal"><span class="pre">Symfony\Component\Security\Core\Exception\AccessDeniedException</span></code>). The raised exception will be converted to the <strong>Error</strong> object automatically by <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Processor/RequestActionProcessor.php">RequestActionProcessor</a>. The all sensible properties of such error objects, like HTTP status code, title and description, are filed based on the
underlying exception object. This is done automatically by services that is named as exception text extractors. The default implementation of such extractor is <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Request/ExceptionTextExtractor.php">ExceptionTextExtractor</a>. To add new extractor just create a class implements
<a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Request/ExceptionTextExtractorInterface.php">ExceptionTextExtractorInterface</a> and tag it with the <code class="docutils literal"><span class="pre">oro.api.exception_text_extractor</span></code> in the dependency injection container.</p>
<p>The another way is to add an <strong>Error</strong> object to the context. This way is good for validation errors because it allows to add several errors. The following example demonstrate it:</p>
<div class="code php highlight-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Oro\Bundle\ApiBundle\Processor\Shared</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ContextInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Component\ChainProcessor\ProcessorInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\ApiBundle\Model\Error</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\ApiBundle\Processor\SingleItemContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\ApiBundle\Request\Constraint</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Makes sure that the identifier of an entity exists in the Context.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">ValidateEntityIdExists</span> <span class="k">implements</span> <span class="nx">ProcessorInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritdoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">process</span><span class="p">(</span><span class="nx">ContextInterface</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var SingleItemContext $context */</span>

        <span class="nv">$entityId</span> <span class="o">=</span> <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$entityId</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">addError</span><span class="p">(</span>
                <span class="nx">Error</span><span class="o">::</span><span class="na">createValidationError</span><span class="p">(</span>
                    <span class="nx">Constraint</span><span class="o">::</span><span class="na">ENTITY_ID</span><span class="p">,</span>
                    <span class="s1">&#39;The identifier of an entity must be set in the context.&#39;</span>
                <span class="p">)</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note that by default the HTTP status code for validation errors is <code class="docutils literal"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code>. But, if needed, an another HTTP status code can be set, e.g. by passing it as a third argument of the <code class="docutils literal"><span class="pre">Error::createValidationError</span></code> method.</p>
<p>Also there is the <a class="reference external" href="https://github.com/oroinc/platform/tree/master/src/Oro/Bundle/ApiBundle/Request/Constraint.php">Constraint</a> class that contains titles for different kind of validation errors. As you can see all titles end with <strong>constraint</strong> word. So, while adding own types please do the same. This is not a strict rule, but it allows to keep Data API consistency.</p>
<p>Sometime you may need to use Data API logger directly in your processors. Actually all Data API logs are written into <strong>api</strong> channel. So, injecting the logger into your processor or other service can be done in a <a class="reference external" href="http://symfony.com/doc/current/reference/dic_tags.html#monolog-logger">common way</a>. For example:</p>
<div class="code yaml highlight-php"><div class="highlight"><pre><span></span><span class="nx">acme</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">some_processor</span><span class="o">:</span>
    <span class="nx">class</span><span class="o">:</span> <span class="nx">Acme\Bundle\AcmeBundle\Api\Processor\DoSomething</span>
    <span class="nx">arguments</span><span class="o">:</span>
        <span class="o">-</span> <span class="s1">&#39;@logger&#39;</span>
    <span class="nx">tags</span><span class="o">:</span>
        <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">oro</span><span class="o">.</span><span class="nx">api</span><span class="o">.</span><span class="nx">processor</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
        <span class="o">-</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">monolog</span><span class="o">.</span><span class="nx">logger</span><span class="p">,</span> <span class="nx">channel</span><span class="o">:</span> <span class="nx">api</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install_upgrade/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../seo_config_guide/index.html">SEO Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frontstore_guide/index.html">Storefront Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../basics/index.html">OroPlatform Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extend_and_customize/index.html">Customizing Oro Features</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Web Services API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../theme/index.html">Customizing the Theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install_upgrade_and_patch/index.html">Extension and Patch Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/index.html">Annotation and Configuration Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../entities/index.html">Using and Managing Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other/index.html">How to... Articles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin_guide/index.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration_guide/index.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system_requirements.html">System Requirements</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Oro Team All rights reserved.
           
      
      |
      <a href="../../../_sources/dev_guide/web_api/api_docs/processors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>