<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to Protect Entities Using ACLs &#8212; OroCommerce 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Import and Export Entities" href="import_export.html" />
    <link rel="prev" title="How to Delete Tasks" href="deleting_tasks.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<script language="javascript" type="text/javascript">
    <!--
    var materialdropdown = document.querySelector('.material-dropdown'),
    middle = document.querySelector('.middle'),
    cross = document.querySelector('.cross'),
    dropdown = document.querySelector('.dropdown');

materialdropdown.addEventListener('click', function() {
  middle.classList.toggle('active');
  cross.classList.toggle('active');
  dropdown.classList.toggle('active');
})
    -->
  </script>
    


  </head>
  <body role="document">
  

    <div class="document">
<div class="header">
    <div class="main-nav">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div id="nav-menu" class="navbar-top">
                <div class="nav-container">
                    <div class="navbar-header">
                        <a href="https://www.orocommerce.com/"
                           class="navbar-brand"><img
                                src="https://www.orocommerce.com/wp-content/themes/commerce/images/orocommerce_logo.svg"
                                alt="Open Source B2B eCommerce Platform - OroCommerce"></a>
                    </div>
                    <div class="navbar-header">
                        <p class="navbar-header" href="#">Documentation</p>
                    </div>
                    <div class="navbar-right">
                        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="import_export.html" title="How to Import and Export Entities"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="deleting_tasks.html" title="How to Delete Tasks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Using and Managing Entities</a> &#187;</li> 
     <li class="nav-item nav-item-this">How to Protect Entities Using ACLs</li>
      </ul>
    </div>
                    </div>

                </div>
            </div>

        </nav>
    </div>
</div>


      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-protect-entities-using-acls">
<h1>How to Protect Entities Using ACLs<a class="headerlink" href="#how-to-protect-entities-using-acls" title="Permalink to this headline">¶</a></h1>
<p>Using ACLs you can granularly grant access to your entities. Doing so requires three steps:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#coobook-entities-acl-enable"><span class="std std-ref">Activate ACL checks for your entities</span></a>.</li>
<li><a class="reference internal" href="#coobook-entities-acl-create"><span class="std std-ref">Create access control lists for all available actions</span></a>.</li>
<li><a class="reference internal" href="#coobook-entities-acl-check"><span class="std std-ref">Add access checks</span></a> to where your entities are displayed or
manipulated.</li>
</ol>
<div class="section" id="activating-acl-checks-on-your-entities">
<span id="coobook-entities-acl-enable"></span><h2>Activating ACL Checks on your Entities<a class="headerlink" href="#activating-acl-checks-on-your-entities" title="Permalink to this headline">¶</a></h2>
<p>In order to have your entity available in the admin UI to be able to assign permissions to your
users you have to enable ACLs for these entities using the <code class="docutils literal"><span class="pre">&#64;Config</span></code> annotation:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Entity/Task.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Bundle\EntityConfigBundle\Metadata\Annotation\Config</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Config(</span>
<span class="sd"> *     defaultValues={</span>
<span class="sd"> *         &quot;security&quot;={</span>
<span class="sd"> *             &quot;type&quot;=&quot;acl&quot;,</span>
<span class="sd"> *             &quot;group_name&quot;=&quot;&quot;</span>
<span class="sd"> *         }</span>
<span class="sd"> *     }</span>
<span class="sd"> * )</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Task</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>After you have done this and have cleared the cache you can toggle all kinds of permission checks
(<code class="docutils literal"><span class="pre">CREATE</span></code>, <code class="docutils literal"><span class="pre">EDIT</span></code>, <code class="docutils literal"><span class="pre">DELETE</span></code>, <code class="docutils literal"><span class="pre">VIEW</span></code>, and <code class="docutils literal"><span class="pre">ASSIGN</span></code>) in the user role management interface.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can use the optional <code class="docutils literal"><span class="pre">group_name</span></code> attribute to group entities by application. The value
of this attribute is used to split the configured access control list into application scopes.</p>
</div>
</div>
<div class="section" id="creating-access-control-lists">
<span id="coobook-entities-acl-create"></span><h2>Creating Access Control Lists<a class="headerlink" href="#creating-access-control-lists" title="Permalink to this headline">¶</a></h2>
<p>You have two options to define your custom access control lists:</p>
<ol class="arabic" id="cookbook-entity-acl-controller">
<li><p class="first">In your controller class, you can use the <code class="docutils literal"><span class="pre">&#64;Acl</span></code> annotation:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBunde/Controller/TaskController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">AppBunde\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\SecurityBundle\Annotation\Acl</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Acl(</span>
<span class="sd">     *   id=&quot;app_task_view&quot;,</span>
<span class="sd">     *   type=&quot;entity&quot;,</span>
<span class="sd">     *   class=&quot;AppBundle:Task&quot;,</span>
<span class="sd">     *   permission=&quot;VIEW&quot;</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Acl(</span>
<span class="sd">     *   id=&quot;app_task_create&quot;,</span>
<span class="sd">     *   type=&quot;entity&quot;,</span>
<span class="sd">     *   class=&quot;AppBundle:Task&quot;,</span>
<span class="sd">     *   permission=&quot;CREATE&quot;</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Acl(</span>
<span class="sd">     *   id=&quot;app_task_edit&quot;,</span>
<span class="sd">     *   type=&quot;entity&quot;,</span>
<span class="sd">     *   class=&quot;AppBundle:Task&quot;,</span>
<span class="sd">     *   permission=&quot;EDIT&quot;</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">editAction</span><span class="p">(</span><span class="nx">Task</span> <span class="nv">$task</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Using the <code class="docutils literal"><span class="pre">&#64;Acl</span></code> annotation does not only create new access control lists to which you can
refer in other parts of your code it will also trigger the access decision manager when your
actions are accessed by users and thus protect them from being accessed without the needed
permissions.</p>
</li>
<li><p class="first">If you do not want to protect any controller methods or if you prefer to keep the definition of
your ACLs separated from the application code, you can define them using some YAML config in a
file named <code class="docutils literal"><span class="pre">acls.yml</span></code>:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># src/AppBunde/Resources/config/oro/acls.yml</span>
<span class="l l-Scalar l-Scalar-Plain">acls</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app_task_create</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
        <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppBunde\Entity\Task</span>
        <span class="l l-Scalar l-Scalar-Plain">permission</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE</span>

    <span class="l l-Scalar l-Scalar-Plain">app_task_delete</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
        <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppBunde\Entity\Task</span>
        <span class="l l-Scalar l-Scalar-Plain">permission</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE</span>

    <span class="l l-Scalar l-Scalar-Plain">app_task_edit</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
        <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppBunde\Entity\Task</span>
        <span class="l l-Scalar l-Scalar-Plain">permission</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">EDIT</span>

    <span class="l l-Scalar l-Scalar-Plain">app_task_view</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
        <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppBunde\Entity\Task</span>
        <span class="l l-Scalar l-Scalar-Plain">permission</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">VIEW</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
<div class="sidebar">
<p class="first sidebar-title">Security Actions that Are not Related to an Entity</p>
<p>You can also create access control lists that are only used to protect certain actions that are
not related to an entity. To do that just set the type of the ACL to <code class="docutils literal"><span class="pre">action</span></code> instead of
<code class="docutils literal"><span class="pre">entity</span></code>:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBunde/Controller/PageController.php</span>
<span class="k">namespace</span> <span class="nx">AppBunde\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Bundle\SecurityBundle\Annotation\Acl</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PageController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Acl(</span>
<span class="sd">     *     id=&quot;app_static_pages&quot;,</span>
<span class="sd">     *     type=&quot;action&quot;</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>When configuring the ACL using the YAML config format, you also have to set the controller to
bind the ACL to using the <code class="docutils literal"><span class="pre">bindings</span></code> option:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># src/AppBunde/Resources/config/oro/acls.yml</span>
<span class="l l-Scalar l-Scalar-Plain">acls</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app_static_pages</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">action</span>
        <span class="l l-Scalar l-Scalar-Plain">bindings</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppBunde\Controller\PageController</span>
            <span class="l l-Scalar l-Scalar-Plain">method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">showAction</span>
</pre></div>
</td></tr></table></div>
<div class="last admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">All configuration options are explained in full details in the <a class="reference internal" href="../reference/annotation/acl.html"><span class="doc">&#64;Acl</span></a>,
<a class="reference internal" href="../reference/annotation/acl_ancestor.html"><span class="doc">&#64;AclAncestor</span></a>, and <a class="reference internal" href="../reference/format/acls.html"><span class="doc">ACL YAML format</span></a>
reference.</p>
</div>
</div>
</div>
<div class="section" id="perform-access-checks">
<span id="coobook-entities-acl-check"></span><h2>Perform Access Checks<a class="headerlink" href="#perform-access-checks" title="Permalink to this headline">¶</a></h2>
<p>Once you have configured the ACLs you can protect all parts of your application. Anywhere in your
PHP code you can use the <code class="docutils literal"><span class="pre">isGranted()</span></code> method of the <code class="docutils literal"><span class="pre">security.authorization_checker</span></code> service
(which is an instance of the <code class="docutils literal"><a class="reference external" href="http://phpdoc.orocrm.com/platform/classes/Symfony.Component.Security.Core.Authorization.AuthorizationCheckerInterface.html" title="Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface"><span class="pre">AuthorizationCheckerInterface</span></a></code> class):</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$authorizationChecker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.authorization_checker&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$authorizationChecker</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;app_task_create&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something when the user is granted permissions for the app_static_pages ACL</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>You can set the second parameter to check access on Object level (with Access Level check):</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$taskEntity</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTask</span><span class="p">();</span>

<span class="nv">$authorizationChecker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.authorization_checker&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$authorizationChecker</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;app_task_update&#39;</span><span class="p">,</span> <span class="nv">$taskEntity</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something when the user is granted permissions for the app_static_pages ACL</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>In case if you does not have proper ACL annotation, you can set the first parameter as the
permission name you want to check:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$taskEntity</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTask</span><span class="p">();</span>

<span class="nv">$authorizationChecker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.authorization_checker&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$authorizationChecker</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;EDIT&#39;</span><span class="p">,</span> <span class="nv">$taskEntity</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something when the user is granted permissions for the app_static_pages ACL</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This example will work the same as before. It will check an EDIT permission for the Task instance object.</p>
<p>However, there are ways to make this checks in different parts of your application:</p>
<div class="section" id="hiding-menu-items">
<h3>Hiding Menu Items<a class="headerlink" href="#hiding-menu-items" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal"><span class="pre">aclResourceId</span></code> option to hide navigation items from users who are not granted to access
the action being linked. The value of this option is the name of the ACL to check for:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># src/AppBunde/Resources/config/oro/navigation.yml</span>
<span class="l l-Scalar l-Scalar-Plain">menu_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">items</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">task_list</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Tasks</span>
            <span class="l l-Scalar l-Scalar-Plain">route</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_task_index</span>
            <span class="l l-Scalar l-Scalar-Plain">aclResourceId</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_task_view</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="protecting-controllers-refering-to-existing-acls">
<h3>Protecting Controllers Refering to Existing ACLs<a class="headerlink" href="#protecting-controllers-refering-to-existing-acls" title="Permalink to this headline">¶</a></h3>
<p>As <a class="reference internal" href="#cookbook-entity-acl-controller"><span class="std std-ref">shown above</span></a> you can define new ACLs and protect your
controllers with them in a single step using the <code class="docutils literal"><span class="pre">&#64;Acl</span></code> annotation. However, you can also refer
to an existing access control list using the <code class="docutils literal"><span class="pre">&#64;AclAncestor</span></code> annotation:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBunde/Controller/TaskController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">AppBunde\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Oro\Bundle\SecurityBundle\Annotation\AclAncestor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @AclAncestor(&quot;app_task_view&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAction</span><span class="p">(</span><span class="nx">Task</span> <span class="nv">$task</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="show-parts-of-templates-based-on-permissions">
<h3>Show Parts of Templates Based on Permissions<a class="headerlink" href="#show-parts-of-templates-based-on-permissions" title="Permalink to this headline">¶</a></h3>
<p>Inside your templates you can use the <code class="docutils literal"><span class="pre">is_granted()</span></code> Twig function to check for certain
permissions to hide parts of your views for users who do not have the required permissions:</p>
<div class="highlight-html+jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# src/AppBundle/Resources/views/Task/update.html.twig #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">someBlock</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;app_task_edit&#39;</span><span class="o">)</span> <span class="cp">%}</span>
        Some info if access is granted
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
<p>In this example we check access by ACL annotation info without Object to test. So, <code class="docutils literal"><span class="pre">is_granted</span></code> will return
true as result if user have any access level to EDIT permission to Task entity.</p>
<p>In case if you want to check access more deeply, you can set the entity instance as the second parameter of
<code class="docutils literal"><span class="pre">is_granted()</span></code> function:</p>
<div class="highlight-html+jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# src/AppBundle/Resources/views/Task/update.html.twig #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">someBlock</span> <span class="cp">%}</span>
    <span class="c">{# an `entity` variable contains an Test entity instance #}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;app_task_edit&#39;</span><span class="o">,</span> <span class="nv">entity</span><span class="o">)</span> <span class="cp">%}</span>
        Some info if access is granted
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
<p>At this example, will be checked access level for the given object instance.</p>
<p>In case if you have no an ACL annotation, you can set the permission name directly as the first parameter:</p>
<div class="highlight-html+jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# src/AppBundle/Resources/views/Task/update.html.twig #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">someBlock</span> <span class="cp">%}</span>
    <span class="c">{# an `entity` variable contains an Test entity instance #}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;EDIT&#39;</span><span class="o">,</span> <span class="nv">entity</span><span class="o">)</span> <span class="cp">%}</span>
        Some info if access is granted
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="restrict-access-to-data-grid-results">
<h3>Restrict Access to Data Grid Results<a class="headerlink" href="#restrict-access-to-data-grid-results" title="Permalink to this headline">¶</a></h3>
<p>In a data grid you can protect the entire result set (to not show results if the user is not
granted access and the action embedding the grid accidentally was not protected):</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># src/AppBundle/Resources/config/oro/datagrids.yml</span>
<span class="l l-Scalar l-Scalar-Plain">datagrids</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app-tasks-grid</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">source</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">acl_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_task_view</span>

    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="hide-unaccessible-grid-actions">
<h3>Hide Unaccessible Grid Actions<a class="headerlink" href="#hide-unaccessible-grid-actions" title="Permalink to this headline">¶</a></h3>
<p>Also use the <code class="docutils literal"><span class="pre">acl_resource</span></code> option to hide actions in a data grid the user does not have access
to:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># src/AppBundle/Resources/config/oro/datagrids.yml</span>
<span class="l l-Scalar l-Scalar-Plain">datagrids</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app-tasks-grid</span><span class="p p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l l-Scalar l-Scalar-Plain">edit</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">navigate</span>
                <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Edit</span>
                <span class="l l-Scalar l-Scalar-Plain">link</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">update_link</span>
                <span class="l l-Scalar l-Scalar-Plain">icon</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">edit</span>
                <span class="l l-Scalar l-Scalar-Plain">acl_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_task_edit</span>
            <span class="l l-Scalar l-Scalar-Plain">delete</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">delete</span>
                <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Delete</span>
                <span class="l l-Scalar l-Scalar-Plain">link</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">delete_link</span>
                <span class="l l-Scalar l-Scalar-Plain">icon</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">trash</span>
                <span class="l l-Scalar l-Scalar-Plain">acl_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_task_delete</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="check-access-on-orm-queries">
<h3>Check Access on ORM Queries<a class="headerlink" href="#check-access-on-orm-queries" title="Permalink to this headline">¶</a></h3>
<p>You can protect your Doctrine ORM query with <code class="docutils literal"><span class="pre">apply</span></code> method of <code class="docutils literal"><span class="pre">oro_security.acl_helper</span></code> service.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Doctrine\ORM\Query</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\QueryBuilder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Oro\Bundle\SecurityBundle\ORM\Walker\AclHelper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAction</span><span class="p">(</span><span class="nx">Task</span> <span class="nv">$task</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var QueryBuilder $qb */</span>
        <span class="nv">$qb</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSomeQuery</span><span class="p">();</span>

        <span class="sd">/** @var Query $query */</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;oro_security.acl_helper&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">apply</span><span class="p">(</span><span class="nv">$qb</span><span class="p">);</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>As result, the query will be modified and the result data set will contain only the records user can see.</p>
<p>By default, VIEW permission used as the second parameter. If you want to check another permission, you can
set it as the second parameter of <code class="docutils literal"><span class="pre">apply</span></code> method.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install_upgrade/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../seo_config_guide/index.html">SEO Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frontstore_guide/index.html">Storefront Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">OroPlatform Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend_and_customize/index.html">Customizing Oro Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web_api/index.html">Web Services API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theme/index.html">Customizing the Theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_upgrade_and_patch/index.html">Extension and Patch Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/index.html">Annotation and Configuration Format</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Using and Managing Entities</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">How to Work with Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating_entities.html">How to Create Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_fixtures.html">How to Load Data Fixtures</a></li>
<li class="toctree-l3"><a class="reference internal" href="datagrids.html">How to Create a Basic Datagrid</a></li>
<li class="toctree-l3"><a class="reference internal" href="managing_tasks.html">How to Create and Modify Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="deleting_tasks.html">How to Delete Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding_properties.html">Add Properties to Core Entities</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to Protect Entities Using ACLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="import_export.html">How to Import and Export Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="report.html">How to Create a Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboards.html">How to Create a Dashboard Widget</a></li>
<li class="toctree-l3"><a class="reference internal" href="using_entities.html">How to Use Entities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../other/index.html">How to... Articles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin_guide/index.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration_guide/index.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system_requirements.html">System Requirements</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Oro Team All rights reserved.
           
      
      |
      <a href="../../_sources/dev_guide/entities/acls.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>